---
alwaysApply: true
---

# Combat System Design

This document details the combat system for **Galactic Clans**, focusing on PvP raids. The system is designed to be strategic, visually engaging, and quick to resolve, while ensuring outcomes are determined by the server for fairness.

## Core Principles

-   **Strategic Depth**: Player choices in army composition and deployment should matter.
-   **Clarity**: The results of a battle should be easy to understand.
-   **Server-Authoritative**: All combat calculations are validated by the server to prevent cheating.

## Raid Flow

This diagram outlines the sequence of events during a player raid.

```mermaid
sequenceDiagram
    participant Attacker
    participant Server
    participant Defender

    Attacker->>Server: Initiate Raid on Defender
    Server->>Attacker: Load Planet View & Confirm
    Attacker->>Server: Deploy Units at Location(s)
    
    loop Combat Simulation
        Server->>Server: Calculate Damage (Unit vs. Building)
        Server->>Server: Update Health & Resource Looted
    end

    Server-->>Attacker: Send Real-time Combat Visuals
    Server-->>Defender: Send "Under Attack" Notification
    
    Server->>Attacker: Display Battle Report (Loot, Losses)
    Server->>Defender: Display Defense Report (Damage, Shield)
    Server->>Server: Update Player Inventories & Leaderboards
```

## Combat Mechanics

-   **Unit Types**:
    -   **Infantry**: High numbers, effective against resource buildings.
    -   **Tanks**: Low numbers, high damage, effective against defensive towers.
    -   **Support**: Heals other units or provides buffs.
-   **Targeting Priority**: Units will automatically target the nearest valid building type. Players can direct units to a specific target initially.
    1.  Defensive Structures (Turrets, etc.)
    2.  Resource Buildings (Mines, Collectors)
    3.  Other Buildings (Town Hall, Barracks)
-   **Damage Calculation**:
    -   `Damage = (UnitAttack * Modifier) - TargetDefense`
    -   `Modifier` is based on unit-vs-building type advantages (e.g., Tanks get a 2x modifier against Turrets).

## Battle Outcome

-   **Victory Conditions**: A raid is successful if the attacker destroys the defender's Town Hall or achieves 50% total destruction.
-   **Loot**: A percentage of the resources from destroyed storage and collector buildings is awarded to the attacker.
-   **Shields**: After being attacked, a defender receives a shield for a period of time, preventing further attacks. The shield duration increases with the percentage of destruction.
