"use strict";(self.webpackChunk_N_E=self.webpackChunk_N_E||[]).push([[365],{5127:(e,t,a)=>{a.d(t,{PlanetRenderer:()=>i});var r=a(7431),n=a(6671);let s=new Map([[n.vA.TEMPERATE_FOREST,[{species:"Oak",height:15,trunkRadius:.8,crownRadius:8,branchCount:12,leafDensity:.8,seasonalColor:new r.Color(2263842),biomeSuitability:1},{species:"Pine",height:25,trunkRadius:.6,crownRadius:4,branchCount:8,leafDensity:.9,seasonalColor:new r.Color(25600),biomeSuitability:.9},{species:"Birch",height:12,trunkRadius:.4,crownRadius:6,branchCount:10,leafDensity:.7,seasonalColor:new r.Color(9498256),biomeSuitability:.8}]],[n.vA.TROPICAL_JUNGLE,[{species:"Mahogany",height:35,trunkRadius:1.2,crownRadius:12,branchCount:15,leafDensity:.95,seasonalColor:new r.Color(25600),biomeSuitability:1},{species:"Kapok",height:40,trunkRadius:1.5,crownRadius:15,branchCount:20,leafDensity:.9,seasonalColor:new r.Color(2263842),biomeSuitability:.95},{species:"Palm",height:20,trunkRadius:.5,crownRadius:8,branchCount:6,leafDensity:.8,seasonalColor:new r.Color(3329330),biomeSuitability:.9}]]]),o={radius:3,seed:Date.now(),starDistance:1,starType:"G",detailLevel:2,featureDensity:.7,colorVariation:.8,enableLOD:!0,maxFeatures:50,renderDistance:100,enableAtmosphere:!0,enableRings:!0,enableMoons:!0,enableSpecialEffects:!0,enableSurfaceDetails:!0,enableVegetation:!0,treeCount:500,terrainDetail:.8,surfaceZoomLevel:1,enableAdvancedLighting:!0,ambientIntensity:.4,sunIntensity:1.5};class i{async renderPlanetByType(e){let t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},a=performance.now(),r={...o,...t},s=(0,n.gN)(e);if(!s)throw Error("Unknown planet class: ".concat(e));let i=this.generateCacheKey(r);if(this.renderCache.has(i)){let e=this.renderCache.get(i);return this.createCachedResult(e,r,a)}try{let e=await this.generatePlanetMesh(s,r);r.enableAtmosphere&&this.addAtmosphere(e,s),r.enableRings&&s.features.rings&&this.addRings(e,s),r.enableMoons&&s.features.moons>0&&this.addMoons(e,s),r.enableSpecialEffects&&this.addSpecialEffects(e,s),r.enableAdvancedLighting&&this.setupAdvancedLighting(e,r),r.enableSurfaceDetails&&this.generateVegetation(e,s,r),this.renderCache.set(i,e);let t=this.calculateRenderMetadata(e,a);return{mesh:e,config:r,planetType:s,statistics:{vertexCount:this.calculatePolyCount(e),featureCount:this.countFeatures(e)},metadata:t}}catch(e){return console.error("Planet rendering failed:",e),this.renderFallbackPlanet(r,a)}}async generatePlanetMesh(e,t){let a=new r.Group,n=new r.SphereGeometry(t.radius||3,32,32),s=this.createPlanetMaterial(e,t),o=new r.Mesh(n,s);return a.add(o),o.rotation.x=.1*Math.PI,a}createPlanetMaterial(e,t){let a=e.primaryColors[0]||new r.Color(4881497);return new r.MeshLambertMaterial({color:a,emissive:new r.Color(1118481),emissiveIntensity:.1})}getMeshRadius(e){let t=e.children[0];return t&&t.geometry instanceof r.SphereGeometry?t.geometry.parameters.radius:3}addAtmosphere(e,t){if(!t.features.clouds)return;let a=this.getMeshRadius(e),n=new r.SphereGeometry(1.1*a,32,32),s=new r.MeshBasicMaterial({color:8900331,transparent:!0,opacity:.3,side:r.BackSide}),o=new r.Mesh(n,s);e.add(o)}addRings(e,t){let a=this.getMeshRadius(e),n=new r.RingGeometry(1.5*a,2.5*a,64),s=new r.MeshBasicMaterial({color:0xcccccc,transparent:!0,opacity:.6,side:r.DoubleSide}),o=new r.Mesh(n,s);o.rotation.x=.5*Math.PI,e.add(o)}addMoons(e,t){let a=Math.min(t.features.moons,3);for(let t=0;t<a;t++){let n=new r.SphereGeometry(.3,16,16),s=new r.MeshLambertMaterial({color:8947848}),o=new r.Mesh(n,s),i=t/a*Math.PI*2,l=4+.5*t;o.position.set(Math.cos(i)*l,Math.sin(i)*l*.3,Math.sin(i)*l*.7),e.add(o)}}addSpecialEffects(e,t){t.class===n.rn.LAVA_WORLD&&this.addLavaParticles(e),t.class===n.rn.ICE_GIANT&&this.addIceShimmers(e),t.features.aurorae&&this.addAuroraEffect(e)}addLavaParticles(e){let t=new r.BufferGeometry,a=new Float32Array(150);for(let e=0;e<150;e+=3)a[e]=(Math.random()-.5)*6,a[e+1]=(Math.random()-.5)*6,a[e+2]=(Math.random()-.5)*6;t.setAttribute("position",new r.BufferAttribute(a,3));let n=new r.PointsMaterial({color:0xff4500,size:.1,transparent:!0,opacity:.8}),s=new r.Points(t,n);e.add(s)}addIceShimmers(e){let t=this.getMeshRadius(e),a=new r.SphereGeometry(1.05*t,32,32),n=new r.MeshBasicMaterial({color:8900331,transparent:!0,opacity:.2,side:r.BackSide}),s=new r.Mesh(a,n);e.add(s)}addAuroraEffect(e){let t=this.getMeshRadius(e),a=new r.SphereGeometry(1.2*t,32,32),n=new r.MeshBasicMaterial({color:65280,transparent:!0,opacity:.1,side:r.BackSide}),s=new r.Mesh(a,n);e.add(s)}generateVegetation(e,t,a){if(!t.features.forests||!a.enableVegetation||t.baseHabitability.overallScore<70)return;console.log("\uD83C\uDF32 [PLANET] Generating vegetation for ".concat(t.name));let o=new r.Group;o.name="vegetation";let i=this.getPrimaryBiome(t),l=s.get(i)||s.get(n.vA.TEMPERATE_FOREST);if(!l)return;let c=Math.min(a.treeCount||500,1e3),h=a.radius||3,d=this.generateTreePositions(c,h);for(let e=0;e<d.length;e++){let t=d[e];if(!t)continue;let a=Math.floor(Math.random()*l.length),r=l[a];if(!r)continue;let n=this.generateTree(r,t,h);n&&o.add(n)}e.add(o),console.log("\uD83C\uDF32 [PLANET] Generated ".concat(o.children.length," trees"))}generateTreePositions(e,t){let a=[];for(let n=0;n<e;n++){let e=0,n=!1;for(;!n&&e<30;){let s=Math.random()*Math.PI*2,o=Math.acos(2*Math.random()-1),i=t*Math.sin(o)*Math.cos(s),l=t*Math.sin(o)*Math.sin(s),c=t*Math.cos(o),h=new r.Vector3(i,l,c);for(let e of(n=!0,a))if(.1>h.distanceTo(e)){n=!1;break}n&&a.push(h),e++}}return a}generateTree(e,t,a){let n=new r.Group,s=a/3*(.8+.4*Math.random()),o=e.height*s*.01,i=e.trunkRadius*s*.01,l=e.crownRadius*s*.01,c=this.generateTrunk(o,i);c&&n.add(c);let h=this.generateCrown(e,o,l);h&&(h.position.y=.7*o,n.add(h));let d=t.clone().normalize();return n.position.copy(t),n.lookAt(t.clone().add(d)),n.rotateY(Math.random()*Math.PI*2),n}generateTrunk(e,t){let a=new r.CylinderGeometry(.8*t,t,e,8),n=new r.MeshLambertMaterial({color:new r.Color(4868682).lerp(new r.Color(9127187),.7)}),s=new r.Mesh(a,n);return s.position.y=e/2,s.castShadow=!0,s.receiveShadow=!0,s}generateCrown(e,t,a){let n=new r.Group,s=3+Math.floor(3*Math.random());for(let o=0;o<s;o++){let s=a*(.6+.4*Math.random()),o=new r.SphereGeometry(s,8,6),i=e.seasonalColor.clone();i.lerp(new r.Color(3100463),.3*Math.random());let l=new r.MeshLambertMaterial({color:i,transparent:!0,opacity:.8+.2*Math.random()}),c=new r.Mesh(o,l);c.position.set((Math.random()-.5)*a*.5,(Math.random()-.5)*t*.3,(Math.random()-.5)*a*.5),c.castShadow=!0,c.receiveShadow=!0,n.add(c)}return n}getPrimaryBiome(e){if(e.possibleBiomes&&e.possibleBiomes.length>0){for(let t of e.possibleBiomes)if(s.has(t))return t}return n.vA.TEMPERATE_FOREST}setupAdvancedLighting(e,t){let a=new r.AmbientLight(4210752,t.ambientIntensity||.4);e.add(a);let n=new r.DirectionalLight(0xffffff,t.sunIntensity||1.5);n.position.set(10,10,5),e.add(n)}getAvailablePlanetTypes(){return Array.from(n.h.keys())}getPlanetTypeInfo(e){return(0,n.gN)(e)}updateQuality(e){let t=Math.max(1,Math.min(5,e));this.clearCache(),console.log("\uD83C\uDF0D [PLANET] Quality updated to level ".concat(t))}dispose(){this.isDisposed||(this.clearCache(),this.isDisposed=!0,console.log("\uD83C\uDF0D [PLANET] Renderer disposed"))}generateCacheKey(e){return"".concat(e.planetClass,"-").concat(e.radius,"-").concat(e.seed,"-").concat(e.detailLevel)}createCachedResult(e,t,a){let r=(0,n.gN)(t.planetClass||n.rn.TERRESTRIAL),s=this.calculateRenderMetadata(e,a);return{mesh:e.clone(),config:t,planetType:r,statistics:{vertexCount:this.calculatePolyCount(e),featureCount:this.countFeatures(e)},metadata:s}}calculateRenderMetadata(e,t){let a=performance.now()-t,r=this.calculatePolyCount(e);return{renderTime:a,polyCount:r,textureCount:1,featureCount:this.countFeatures(e),memoryUsage:32*r,qualityLevel:this.determineQualityLevel(r,1)}}calculatePolyCount(e){let t=0;return e.traverse(e=>{if(e instanceof r.Mesh&&e.geometry){let a=e.geometry;a.attributes.position&&(t+=a.attributes.position.count/3)}}),t}countFeatures(e){let t=0;return e.traverse(e=>{e instanceof r.Mesh&&t++}),t}determineQualityLevel(e,t){return e>1e4?"Ultra":e>5e3?"High":e>2e3?"Medium":"Low"}renderFallbackPlanet(e,t){console.warn("\uD83C\uDF0D [PLANET] Using fallback planet renderer");let a=new r.SphereGeometry(e.radius||3,16,16),s=new r.MeshBasicMaterial({color:8421504}),o=new r.Mesh(a,s),i=new r.Group;i.add(o);let l=(0,n.gN)(n.rn.TERRESTRIAL),c=this.calculateRenderMetadata(i,t);return{mesh:i,config:e,planetType:l,statistics:{vertexCount:256,featureCount:1},metadata:c}}getPerformanceStats(){return{lastRenderTime:this.lastRenderTime,cacheSize:this.renderCache.size}}clearCache(){this.renderCache.forEach(e=>{this.disposeMesh(e)}),this.renderCache.clear(),console.log("\uD83C\uDF0D [PLANET] Cache cleared")}disposeMesh(e){e.traverse(e=>{e instanceof r.Mesh&&(e.geometry&&e.geometry.dispose(),e.material&&(Array.isArray(e.material)?e.material.forEach(e=>e.dispose()):e.material.dispose()))})}async preloadCommonTypes(){let e=[n.rn.TERRESTRIAL,n.rn.GAS_GIANT,n.rn.ICE_GIANT];for(let t of(console.log("\uD83C\uDF0D [PLANET] Preloading common planet types..."),e))try{await this.renderPlanetByType(t,{detailLevel:1})}catch(e){console.warn("\uD83C\uDF0D [PLANET] Failed to preload ".concat(t,":"),e)}console.log("\uD83C\uDF0D [PLANET] Preloading complete")}constructor(){this.isDisposed=!1,this.renderCache=new Map,this.lastRenderTime=0}}}}]);